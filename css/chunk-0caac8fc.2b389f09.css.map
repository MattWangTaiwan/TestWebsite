{"version":3,"sources":["webpack:///src/views/Member/src/views/Member/AssociationTemplate.vue"],"names":[],"mappings":"AA+GA,+BACA,UAAA,CACA,YACA","file":"chunk-0caac8fc.2b389f09.css","sourcesContent":["<template>\n  <iframe class=\"iframe-panel\" v-if=\"isAssociated\"\n          :src=\"`https://www.public.com.tw/member-certification/4010/${stateUserId}`\"></iframe>\n<!--  <iframe src=\"https://mattwangtaiwan.github.io/iframe.html\"></iframe>-->\n</template>\n\n<script lang=\"ts\">\nimport Swal from 'sweetalert2';\nimport { Component, Vue } from 'vue-property-decorator';\nimport { Action, State } from 'vuex-class';\nimport { IInputInfo, IMergeUserGuid } from '@/types/interface';\n\n@Component\nexport default class AssociationTemplate extends Vue {\n  @State('userId') stateUserId!: string;\n  @State('name') stateName!: string;\n  @Action('addCkMember') addCkMember!: (params: IInputInfo) => Promise<string>;\n  @Action('getMemberUser') getMemberUser!: (params: IInputInfo) => Promise<string>\n  @Action('mergeUserApply') mergeUserApply!: (params: IMergeUserGuid[]) => Promise<void>;\n\n  isAssociated = false;\n\n  get isMemberProcess() {\n    return this.$route.query.process === 'member';\n  }\n\n  created() {\n    if (this.isMemberProcess) {\n      this.isAssociated = true;\n      window.addEventListener('message', this.receiveMessage, false);\n    } else {\n      Swal.fire({\n        width: 300,\n        showCloseButton: false,\n        showCancelButton: true,\n        background: '#FFFFFF',\n        title: '是否關聯公職王帳號',\n        text: '',\n        customClass: {\n          title: 'modal-title',\n          content: 'modal-content',\n          confirmButton: 'modal-confirm-button-half',\n          cancelButton: 'modal-cancel-button-half',\n        },\n        confirmButtonText: '關聯',\n        cancelButtonText: '略過',\n        reverseButtons: true,\n      }).then((res) => {\n        if (res.isConfirmed) {\n          this.isAssociated = true;\n          window.addEventListener('message', this.receiveMessage, false);\n        } else this.$router.push('/login/set_member_profile');\n      });\n    }\n  }\n\n  receiveMessage(e: any) {\n    if (e.origin === 'https://www.public.com.tw' && e.data.Data) {\n      console.log(JSON.stringify(e));\n      const params = {\n        // eslint-disable-next-line\n        Approve_Key: e.data.Data.certification_guid,\n        PID: e.data.Data.id,\n        Name: this.stateName,\n        Source: 'CF04',\n        Status: '0',\n      };\n      if (e.data.Data.Code === '0000') {\n        this.addCkMember(params)\n          .then((ckId: string) => {\n            const temp = [{\n              UserGuid: this.stateUserId,\n              MergeGuid: ckId,\n            }];\n            return this.mergeUserApply(temp);\n          })\n          .then(() => {\n            this.showMessage(true, '');\n          })\n          .catch((errMsg: string) => {\n            this.showMessage(false, errMsg);\n          });\n      } else if (e.data.Data.Code === '7997' || e.data.Data.Code === '7998'\n                  || e.data.Data.Code === '7999' || e.data.Data.Code === '6996') {\n        this.showMessage(false, e.data.Data.Message);\n      }\n    }\n  }\n\n  showMessage(flag: boolean, msg: string) {\n    Swal.fire({\n      width: 300,\n      showCloseButton: false,\n      background: '#FFFFFF',\n      title: flag ? '關聯成功' : '關聯失敗',\n      text: msg,\n      customClass: {\n        title: 'modal-title',\n        content: 'modal-content',\n        confirmButton: 'modal-confirm-button',\n      },\n      confirmButtonText: '確認',\n    }).then(() => {\n      if (this.isMemberProcess) this.$router.push('/member/edit_profile');\n      else this.$router.push('/login/set_member_profile');\n    });\n  }\n}\n</script>\n\n<style scoped>\n  .iframe-panel {\n    width: 100%;\n    height: 100vh;\n  }\n</style>\n"]}